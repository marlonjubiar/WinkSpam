<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>WinkSpam Pro</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=SF+Pro+Display:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        :root {
            --app-bg: #000000;
            --card-bg: #1c1c1e;
            --input-bg: #2c2c2e;
            --border-color: #38383a;
            --text-primary: #ffffff;
            --text-secondary: #8e8e93;
            --accent-blue: #0a84ff;
            --accent-green: #30d158;
            --accent-red: #ff453a;
            --blur-bg: rgba(0, 0, 0, 0.8);
        }

        * {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background-color: var(--app-bg);
            color: var(--text-primary);
        }

        /* Modern iOS Card Style */
        .ios-card {
            background-color: var(--card-bg);
            border-radius: 16px;
            border: 1px solid var(--border-color);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
        }

        /* iOS-style Input */
        .ios-input {
            background-color: var(--input-bg);
            border: none;
            border-radius: 12px;
            color: var(--text-primary);
            padding: 12px 16px;
            font-size: 16px;
            transition: all 0.2s;
        }

        .ios-input:focus {
            outline: none;
            box-shadow: 0 0 0 2px var(--accent-blue);
        }

        /* iOS Button Styles */
        .ios-button {
            background-color: var(--accent-blue);
            border-radius: 12px;
            padding: 12px 20px;
            font-weight: 600;
            transition: all 0.2s;
        }

        .ios-button:active {
            transform: scale(0.98);
            opacity: 0.9;
        }

        /* iOS Switch */
        .ios-switch {
            width: 51px;
            height: 31px;
            background-color: var(--input-bg);
            border-radius: 31px;
            position: relative;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .ios-switch::after {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 27px;
            height: 27px;
            background-color: white;
            border-radius: 50%;
            transition: transform 0.2s;
        }

        .ios-switch.active {
            background-color: var(--accent-green);
        }

        .ios-switch.active::after {
            transform: translateX(20px);
        }

        /* iOS Progress Bar */
        .ios-progress {
            height: 6px;
            background-color: var(--input-bg);
            border-radius: 3px;
            overflow: hidden;
        }

        .ios-progress-bar {
            height: 100%;
            background-color: var(--accent-blue);
            transition: width 0.3s ease;
        }

        /* iOS-style Toast */
        .ios-toast {
            background-color: var(--card-bg);
            border: 1px solid var(--border-color);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 14px;
            padding: 12px 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            animation: slideUp 0.3s ease-out;
        }

        @keyframes slideUp {
            from {
                transform: translateY(100%);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        /* iOS-style Modal */
        .ios-modal {
            background-color: var(--card-bg);
            border-radius: 20px;
            max-width: 90%;
            width: 400px;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 1000;
        }

        .modal-backdrop {
            background-color: var(--blur-bg);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        /* Stats Container */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
        }

        .stat-card {
            background-color: var(--input-bg);
            border-radius: 12px;
            padding: 12px;
            text-align: center;
        }

        /* Responsive Design */
        @media (max-width: 640px) {
            .ios-card {
                border-radius: 12px;
                padding: 16px;
            }

            .ios-button {
                padding: 10px 16px;
            }

            .stats-grid {
                gap: 8px;
            }

            .stat-card {
                padding: 8px;
            }
        }

        /* Animation Keyframes */
        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.5;
            }
        }

        .animate-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        /* Loading Spinner */
        .loading-spinner {
            width: 20px;
            height: 20px;
            border: 2px solid var(--text-secondary);
            border-top-color: var(--accent-blue);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">
    <!-- Navigation Bar -->
    <header class="sticky top-0 z-50 backdrop-blur-xl bg-[#000000cc]">
        <div class="max-w-5xl mx-auto px-4 h-16 flex items-center justify-between">
            <div class="flex items-center space-x-3">
                <img src="https://i.imgur.com/wyAJhIm.jpeg" alt="Logo" class="w-8 h-8 rounded-lg">
                <span class="text-lg font-semibold">WinkSpam Pro</span>
            </div>
            <div class="flex items-center space-x-2">
                <button id="settingsBtn" class="p-2 rounded-full hover:bg-[#ffffff1a] transition-colors">
                    <i data-lucide="settings" class="w-5 h-5"></i>
                </button>
                <button id="logoutBtn" class="hidden p-2 rounded-full hover:bg-[#ff453a1a] text-[#ff453a] transition-colors">
                    <i data-lucide="log-out" class="w-5 h-5"></i>
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-1 max-w-5xl mx-auto w-full px-4 py-6">
        <!-- Authentication Section -->
        <div id="keySection" class="ios-card p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">Authentication</h2>
            <div class="space-y-4">
                <div>
                    <input type="text" id="key" placeholder="Enter your access key" 
                           class="ios-input w-full">
                </div>
                <div class="flex items-center justify-between">
                    <label class="text-[#8e8e93]">Remember Key</label>
                    <div id="rememberKey" class="ios-switch"></div>
                </div>
                <button onclick="validateKey()" class="ios-button w-full text-white">
                    Validate Key
                </button>
                <div class="text-center">
                    <button onclick="generateKey()" class="text-[#0a84ff] text-sm">
                        Generate New Key
                    </button>
                </div>
            </div>
        </div>

        <!-- Share Section -->
        <div id="shareSection" class="hidden">
            <div class="ios-card p-6 mb-6">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-xl font-semibold">Share Configuration</h2>
                    <span id="planBadge" class="px-3 py-1 rounded-full text-xs font-medium bg-[#0a84ff1a] text-[#0a84ff]">
                        Free Plan
                    </span>
                </div>
                <div class="space-y-4">
                    <div>
                        <label class="text-sm text-[#8e8e93] mb-2 block">Post ID</label>
                        <input type="text" id="postId" placeholder="Enter Facebook Post ID" 
                               class="ios-input w-full">
                    </div>
                    <div>
                        <div class="flex justify-between mb-2">
                            <label class="text-sm text-[#8e8e93]">Share Count</label>
                            <span id="maxSharesLabel" class="text-xs text-[#8e8e93]">Available: 0</span>
                        </div>
                        <input type="number" id="shareCount" placeholder="1-1000" min="1" max="1000"
                               class="ios-input w-full">
                    </div>

                    <!-- Progress Bar -->
                    <div id="progressBar" class="hidden space-y-2">
                        <div class="ios-progress">
                            <div class="ios-progress-bar" style="width: 0%"></div>
                        </div>
                        <div class="flex justify-between text-xs text-[#8e8e93]">
                            <span id="progressText">0%</span>
                            <span id="progressCount">0/0</span>
                        </div>
                    </div>

                    <button onclick="startShare()" class="ios-button w-full text-white">
                        Start Share Process
                    </button>

                    <!-- Stats Grid -->
                    <div id="shareStats" class="hidden stats-grid mt-4">
                        <div class="stat-card">
                            <div class="text-xs text-[#8e8e93] mb-1">Success</div>
                            <div id="successCount" class="text-lg font-semibold text-[#30d158]">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="text-xs text-[#8e8e93] mb-1">Failed</div>
                            <div id="failedCount" class="text-lg font-semibold text-[#ff453a]">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="text-xs text-[#8e8e93] mb-1">Remaining</div>
                            <div id="remainingCount" class="text-lg font-semibold">0</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Status Section -->
        <div id="status" class="hidden"></div>
    </main>

    <!-- Settings Modal -->
    <div id="settingsModal" class="hidden fixed inset-0 modal-backdrop">
        <div class="ios-modal p-6">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-semibold">Settings</h3>
                <button onclick="closeSettings()" class="text-[#8e8e93] hover:text-white transition-colors">
                    <i data-lucide="x" class="w-6 h-6"></i>
                </button>
            </div>
            <div class="space-y-6">
                <!-- Plan Info -->
                <div class="ios-card p-4">
                    <h4 class="text-sm font-medium text-[#8e8e93] mb-3">Your Plan</h4>
                    <div class="space-y-2">
                        <div class="flex justify-between">
                            <span class="text-[#8e8e93]">Type</span>
                            <span id="planType" class="font-medium">Free Plan</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-[#8e8e93]">Share Limit</span>
                            <span id="shareLimit" class="font-medium">250 per request</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-[#8e8e93]">Cooldown</span>
                            <span id="planCooldown" class="font-medium">60 seconds</span>
                        </div>
                    </div>
                </div>

                <!-- Usage Stats -->
                <div class="ios-card p-4">
                    <h4 class="text-sm font-medium text-[#8e8e93] mb-3">Usage Statistics</h4>
                    <div class="space-y-2">
                        <div class="flex justify-between">
                            <span class="text-[#8e8e93]">Total Shares</span>
                            <span id="totalShares" class="font-medium">0</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-[#8e8e93]">Last Used</span>
                            <span id="lastUsed" class="font-medium">Never</span>
                        </div>
                    </div>
                </div>

                <!-- Support -->
                <div class="ios-card p-4">
                  <!-- Support Section (continued) -->
                    <h4 class="text-sm font-medium text-[#8e8e93] mb-3">Support</h4>
                    <a href="https://t.me/yourhandle" target="_blank" 
                       class="ios-button w-full flex items-center justify-center gap-2 text-white">
                        <i data-lucide="message-circle" class="w-4 h-4"></i>
                        Contact Support
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Help Modal -->
    <div id="helpModal" class="hidden fixed inset-0 modal-backdrop">
        <div class="ios-modal p-6">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-semibold">How to Find Post ID</h3>
                <button onclick="closeHelp()" class="text-[#8e8e93] hover:text-white transition-colors">
                    <i data-lucide="x" class="w-6 h-6"></i>
                </button>
            </div>
            <div class="space-y-4">
                <p class="text-[#8e8e93]">To find a Facebook post ID:</p>
                <ol class="space-y-3 list-decimal list-inside text-[#8e8e93]">
                    <li>Open the post you want to share</li>
                    <li>Look at the URL in your browser</li>
                    <li>Find the long number after "/posts/"</li>
                    <li>That number is your Post ID</li>
                </ol>
                <div class="ios-card p-4 mt-4">
                    <p class="text-[#8e8e93] mb-2">Example URL:</p>
                    <code class="text-[#0a84ff] text-sm break-all">https://facebook.com/username/posts/123456789</code>
                    <p class="text-[#8e8e93] mt-2">Post ID would be: <span class="text-[#0a84ff]">123456789</span></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toast-container" class="fixed bottom-4 right-4 z-50 space-y-2"></div>

    <script>
        // Initialize Lucide icons
        lucide.createIcons();

        // Global variables
        let shareInProgress = false;
        let currentCooldown = 0;

        // UI Helper Functions
        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `ios-toast flex items-center gap-2 max-w-sm`;
            
            const icon = type === 'success' ? 'check-circle' : 'alert-circle';
            const color = type === 'success' ? '#30d158' : '#ff453a';
            
            toast.innerHTML = `
                <i data-lucide="${icon}" class="w-5 h-5" style="color: ${color}"></i>
                <span class="text-sm">${message}</span>
            `;
            
            document.getElementById('toast-container').appendChild(toast);
            lucide.createIcons();

            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transform = 'translateY(100%)';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        function showStatus(message, isError = false) {
            const statusEl = document.getElementById('status');
            statusEl.className = `ios-card p-6 mb-6 ${isError ? 'border-[#ff453a]' : ''}`;
            statusEl.innerHTML = `
                <div class="flex items-center gap-3">
                    <i data-lucide="${isError ? 'alert-circle' : 'check-circle'}" 
                       class="w-5 h-5" style="color: ${isError ? '#ff453a' : '#30d158'}"></i>
                    <span>${message}</span>
                </div>
            `;
            statusEl.classList.remove('hidden');
            lucide.createIcons();
        }

        function updateProgress(completed, total) {
            const percentage = Math.floor((completed / total) * 100);
            document.querySelector('.ios-progress-bar').style.width = `${percentage}%`;
            document.getElementById('progressText').textContent = `${percentage}%`;
            document.getElementById('progressCount').textContent = `${completed}/${total}`;
            
            // Update stats
            document.getElementById('successCount').textContent = completed;
            document.getElementById('failedCount').textContent = total - completed;
            document.getElementById('remainingCount').textContent = total - completed;
        }

        // Key Management
        function validateKey() {
            const key = document.getElementById('key').value;
            const remember = document.getElementById('rememberKey').classList.contains('active');

            if (!key) {
                showToast('Please enter a key', 'error');
                return;
            }

            $.post('/validate_key', { 
                key: key,
                remember: remember 
            }, function(response) {
                if (response.status === 'success') {
                    document.getElementById('keySection').style.display = 'none';
                    document.getElementById('shareSection').classList.remove('hidden');
                    document.getElementById('logoutBtn').classList.remove('hidden');
                    
                    updatePlanInfo(response.key_info);
                    showToast('Key validated successfully');
                    updateTokenCount();
                } else {
                    showToast(response.message, 'error');
                }
            });
        }

        function generateKey() {
            $.post('/generate_key', function(response) {
                showStatus(`
                    <div class="space-y-4">
                        <div class="ios-card p-4">
                            <p class="text-[#8e8e93] mb-2">Your new key:</p>
                            <code class="text-[#0a84ff] break-all">${response.key}</code>
                        </div>
                        <div class="flex items-center gap-2 text-[#ff9f0a]">
                            <i data-lucide="alert-triangle" class="w-4 h-4"></i>
                            <span>Key requires admin approval before use</span>
                        </div>
                    </div>
                `);
            });
        }

        // Share Management
        async function startShare() {
            if (shareInProgress) return;

            const postId = document.getElementById('postId').value;
            const shareCount = parseInt(document.getElementById('shareCount').value);
            const maxShares = parseInt(document.getElementById('shareCount').max);

            if (!postId || !shareCount) {
                showToast('Please fill in all fields', 'error');
                return;
            }

            if (shareCount < 1 || shareCount > maxShares) {
                showToast(`Share count must be between 1 and ${maxShares}`, 'error');
                return;
            }

            shareInProgress = true;
            document.getElementById('progressBar').classList.remove('hidden');
            document.getElementById('shareStats').classList.remove('hidden');

            let completedShares = 0;
            
            while (completedShares < shareCount) {
                try {
                    const response = await $.post('/share', {
                        post_id: postId,
                        share_count: shareCount - completedShares
                    });

                    if (response.status === 'success') {
                        completedShares += response.success_count;
                        updateProgress(completedShares, shareCount);
                        
                        if (response.key_info) {
                            updatePlanInfo(response.key_info);
                        }
                    } else {
                        showToast(response.message, 'error');
                        break;
                    }
                } catch (error) {
                    showToast('An error occurred', 'error');
                    break;
                }
            }

            shareInProgress = false;
        }

        // Token Management
        function updateTokenCount() {
            $.get('/get_token_count', function(response) {
                if (response.status === 'success') {
                    const count = response.count;
                    document.getElementById('maxSharesLabel').textContent = `Available: ${count}`;
                    document.getElementById('shareCount').max = count;
                }
            });
        }

        // Event Listeners
        document.addEventListener('DOMContentLoaded', function() {
            // Check session
            $.get('/check_session', function(response) {
                if (response.status === 'success') {
                    document.getElementById('key').value = response.key;
                    document.getElementById('keySection').style.display = 'none';
                    document.getElementById('shareSection').classList.remove('hidden');
                    document.getElementById('logoutBtn').classList.remove('hidden');
                    
                    updatePlanInfo(response.key_info);
                    updateTokenCount();
                }
            });

            // iOS Switch functionality
            document.getElementById('rememberKey').addEventListener('click', function() {
                this.classList.toggle('active');
            });

            // Modal handlers
            document.getElementById('settingsBtn').addEventListener('click', showSettings);
            document.getElementById('logoutBtn').addEventListener('click', logout);
        });

        // Initialize
        lucide.createIcons();
    </script>
</body>
</html>
